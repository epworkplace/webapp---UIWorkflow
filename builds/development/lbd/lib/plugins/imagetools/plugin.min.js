!function(t,e){"use strict";function n(t,e){for(var n,o=[],r=0;r<t.length;++r){if(!(n=a[t[r]]||i(t[r])))throw"module definition dependecy not found: "+t[r];o.push(n)}e.apply(null,o)}function o(t,o,i){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(o===e)throw"invalid module definition, dependencies must be specified";if(i===e)throw"invalid module definition, definition function must be specified";n(o,function(){a[t]=i.apply(null,arguments)})}function i(e){for(var n=t,o=e.split(/[.\/]/),i=0;i<o.length;++i){if(!n[o[i]])return;n=n[o[i]]}return n}var a={};o("tinymce/imagetoolsplugin/Canvas",[],function(){function t(t,e,n){return t.width=e,t.height=n,t}return{create:function(e,n){return t(document.createElement("canvas"),e,n)},resize:t,get2dContext:function(t){return t.getContext("2d")}}}),o("tinymce/imagetoolsplugin/Mime",[],function(){function t(t){var e=document.createElement("a");return e.href=t,e.pathname}return{guessMimeType:function(e){var n=t(e).split("."),o=n[n.length-1],i={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return o&&(o=o.toLowerCase()),i[o]}}}),o("tinymce/imagetoolsplugin/ImageSize",[],function(){return{getWidth:function(t){return t.naturalWidth||t.width},getHeight:function(t){return t.naturalHeight||t.height}}}),o("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(t,e,n,o){function i(e){return new t(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})}function a(t){return i(t).then(function(t){var n;return n=e.create(o.getWidth(t),o.getHeight(t)),e.get2dContext(n).drawImage(t,0,0),n})}function r(e){return new t(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function c(e){return new t(function(t){var n,o,i,a,r,c;if(e=e.split(","),(a=/data:([^;]+)/.exec(e[0]))&&(r=a[1]),n=atob(e[1]),window.WebKitBlobBuilder){for(c=new WebKitBlobBuilder,o=new ArrayBuffer(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);return c.append(o),void t(c.getBlob(r))}for(o=new Uint8Array(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:r}))})}function l(e){return new t(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})}return{blobToImage:function(e){return new t(function(t){function n(){o.removeEventListener("load",n),t(o)}var o=new Image;o.addEventListener("load",n),o.src=URL.createObjectURL(e),o.complete&&n()})},imageToBlob:function(t){return i(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?r(e):0===e.indexOf("data:")?c(e):a(t).then(function(t){return c(t.toDataURL(n.guessMimeType(e)))})})},uriToBlob:function(t){return 0===t.indexOf("blob:")?r(t):0===t.indexOf("data:")?c(t):null},blobToDataUri:l,blobToBase64:function(t){return l(t).then(function(t){return t.split(",")[1]})},imageToCanvas:a,canvasToBlob:function(t,e){return c(t.toDataURL(e))},revokeImageUrl:function(t){URL.revokeObjectURL(t.src)}}}),o("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(t,e,n){var o=t.revokeImageUrl;return{rotate:function(i,a){return t.blobToImage(i).then(function(r){var c=e.create(n.getWidth(r),n.getHeight(r)),l=e.get2dContext(c),u=0,s=0;return(90==(a=0>a?360+a:a)||270==a)&&e.resize(c,c.height,c.width),(90==a||180==a)&&(u=c.width),(270==a||180==a)&&(s=c.height),l.translate(u,s),l.rotate(a*Math.PI/180),l.drawImage(r,0,0),o(r),t.canvasToBlob(c,i.type)})},flip:function(i,a){return t.blobToImage(i).then(function(i){var r=e.create(n.getWidth(i),n.getHeight(i)),c=e.get2dContext(r);return"v"==a?(c.scale(1,-1),c.drawImage(i,0,-r.height)):(c.scale(-1,1),c.drawImage(i,-r.width,0)),o(i),t.canvasToBlob(r)})},crop:function(n,i,a,r,c){return t.blobToImage(n).then(function(n){var l=e.create(r,c);return e.get2dContext(l).drawImage(n,-i,-a),o(n),t.canvasToBlob(l)})},resize:function(n,i,a){return t.blobToImage(n).then(function(r){var c=e.create(i,a);return e.get2dContext(c).drawImage(r,0,0,i,a),o(r),t.canvasToBlob(c,n.type)})}}}),o("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(t,e,n,o,i){var a=0;return function(r,c,l,u){function s(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function d(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function g(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+w+"-"+e,u).css({left:n.x,top:n.y,width:n.w,height:n.h})}o.each(p,function(n){t("#"+w+"-"+n.name,u).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:c.x,y:c.y,w:c.w,h:e.y-c.y}),n("right",{x:e.x+e.w,y:e.y,w:c.w-e.x-e.w+c.x,h:e.h}),n("bottom",{x:c.x,y:e.y+e.h,w:c.w,h:c.h-e.y-e.h+c.y}),n("left",{x:c.x,y:e.y,w:e.x-c.x,h:e.h}),n("move",e)}function f(t){g(r=t)}function m(t){f(s(l,t))}var h,p,y,v,b="mce-",w=b+"crid-"+a++;return p=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}],v=["top","right","bottom","left"],function(){t('<div id="'+w+'" class="'+b+'croprect-container" data-mce-bogus="all">').appendTo(u),o.each(v,function(e){t("#"+w,u).append('<div id="'+w+"-"+e+'"class="'+b+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(p,function(e){t("#"+w,u).append('<div id="'+w+"-"+e.name+'" class="'+b+"croprect-handle "+b+"croprect-handle-"+e.name+'" style="display: none" data-mce-bogus="all">')}),y=o.map(p,function(t){var o;return new e(w,{document:u.ownerDocument,handle:w+"-"+t.name,start:function(){o=r},drag:function(e){var i,a,c,u,s;i=o.x,a=o.y,c=o.w,u=o.h,i+=e.deltaX*t.deltaX,a+=e.deltaY*t.deltaY,c+=e.deltaX*t.deltaW,u+=e.deltaY*t.deltaH,20>c&&(c=20),20>u&&(u=20),s=r=n.clamp({x:i,y:a,w:c,h:u},l,"move"==t.name),s=d(l,s),h.fire("updateRect",{rect:s}),m(s)}})}),g(r)}(),h=o.extend({toggleVisibility:function(e){var n;n=o.map(p,function(t){return"#"+w+"-"+t.name}).concat(o.map(v,function(t){return"#"+w+"-"+t})).join(","),e?t(n,u).show():t(n,u).hide()},setClampRect:function(t){l=t,g(r)},setRect:f,getInnerRect:function(){return d(l,r)},setInnerRect:m,setViewPortRect:function(t){c=t,g(r)},destroy:function(){o.each(y,function(t){t.destroy()}),y=[]}},i)}}),o("tinymce/imagetoolsplugin/ImagePanel",["tinymce/ui/Control","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Promise","tinymce/imagetoolsplugin/CropRect"],function(t,e,n,o,i,a){function r(t){return new i(function(e){function n(){t.removeEventListener("load",n),e(t)}t.complete?e(t):t.addEventListener("load",n)})}return t.extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(t){var e=this,o=new Image;o.src=t,r(o).then(function(){var t,i,a=e.state.get("viewRect");(i=e.$el.find("img"))[0]?i.replaceWith(o):e.getEl().appendChild(o),t={x:0,y:0,w:o.naturalWidth,h:o.naturalHeight},e.state.set("viewRect",t),e.state.set("rect",n.inflate(t,-20,-20)),a&&a.w==t.w&&a.h==t.h||e.zoomFit(),e.repaintImage(),e.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,i,a,r=this;t=r.$el.find("img"),e=r.getEl().clientWidth,n=r.getEl().clientHeight,o=t[0].naturalWidth,i=t[0].naturalHeight,(a=Math.min((e-10)/o,(n-10)/i))>=1&&(a=1),r.zoom(a)},repaintImage:function(){var t,e,n,o,i,a,r,c,l,u;u=this.getEl(),c=this.zoom(),l=this.state.get("rect"),r=this.$el.find("img"),i=u.offsetWidth,a=u.offsetHeight,n=r[0].naturalWidth*c,o=r[0].naturalHeight*c,t=Math.max(0,i/2-n/2),e=Math.max(0,a/2-o/2),r.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+e,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:i,h:a}))},bindStates:function(){function t(t){e.cropRect=new a(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl()),e.cropRect.on("updateRect",function(t){var n=t.rect,o=e.zoom();n={x:Math.round(n.x/o),y:Math.round(n.y/o),w:Math.round(n.w/o),h:Math.round(n.h/o)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var o=n.value;e.cropRect||t(o),e.cropRect.setRect(o)})}})}),o("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function t(t,e,n){return(t=parseFloat(t))>n?t=n:e>t&&(t=e),t}function e(t,e){var n,o,i,a,r=[],c=new Array(10);for(n=0;5>n;n++){for(o=0;5>o;o++)r[o]=e[o+5*n];for(o=0;5>o;o++){for(a=0,i=0;5>i;i++)a+=t[o+5*i]*r[i];c[o+5*n]=a}}return c}function n(e,n){return n=t(n,0,1),e.map(function(e,o){return o%6==0?e=1-(1-e)*n:e*=n,t(e,0,1)})}var o=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:n,multiply:e,adjustContrast:function(n,i){var a;return i=t(i,-1,1),0>(i*=100)?a=127+i/100*127:(a=i%1,a=0===a?o[i]:o[Math.floor(i)]*(1-a)+o[Math.floor(i)+1]*a,a=127*a+127),e(n,[a/127,0,0,0,.5*(127-a),0,a/127,0,0,.5*(127-a),0,0,a/127,0,.5*(127-a),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(n,o){return o=t(255*o,-255,255),e(n,[1,0,0,0,o,0,1,0,0,o,0,0,1,0,o,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(n,o){var i,a,r,c;return o=t(o,-1,1),i=1+(o>0?3*o:o),a=.3086,r=.6094,c=.082,e(n,[a*(1-i)+i,r*(1-i),c*(1-i),0,0,a*(1-i),r*(1-i)+i,c*(1-i),0,0,a*(1-i),r*(1-i),c*(1-i)+i,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(n,o){var i,a,r,c,l;return o=t(o,-180,180)/180*Math.PI,i=Math.cos(o),a=Math.sin(o),r=.213,c=.715,l=.072,e(n,[r+i*(1-r)+a*-r,c+i*-c+a*-c,l+i*-l+a*(1-l),0,0,r+i*-r+.143*a,c+i*(1-c)+.14*a,l+i*-l+-.283*a,0,0,r+i*-r+-.787*a,c+i*-c+a*c,l+i*(1-l)+a*l,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(n,o,i,a){return o=t(o,0,2),i=t(i,0,2),a=t(a,0,2),e(n,[o,0,0,0,0,0,i,0,0,0,0,0,a,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(o,i){return i=t(i,0,1),e(o,n([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],i))},adjustGrayscale:function(o,i){return i=t(i,0,1),e(o,n([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],i))}}}),o("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(t,e,n,o){function i(o,i){return n.blobToImage(o).then(function(o){var a,r=t.create(e.getWidth(o),e.getHeight(o)),c=t.get2dContext(r);return c.drawImage(o,0,0),u(o),a=function(t,e){var n,o,i,a,r,c=t.data,l=e[0],u=e[1],s=e[2],d=e[3],g=e[4],f=e[5],m=e[6],h=e[7],p=e[8],y=e[9],v=e[10],b=e[11],w=e[12],x=e[13],k=e[14],I=e[15],R=e[16],C=e[17],M=e[18],T=e[19];for(r=0;r<c.length;r+=4)n=c[r],o=c[r+1],i=c[r+2],a=c[r+3],c[r]=n*l+o*u+i*s+a*d+g,c[r+1]=n*f+o*m+i*h+a*p+y,c[r+2]=n*v+o*b+i*w+a*x+k,c[r+3]=n*I+o*R+i*C+a*M+T;return t}(c.getImageData(0,0,r.width,r.height),i),c.putImageData(a,0,0),n.canvasToBlob(r)})}function a(o,i){return n.blobToImage(o).then(function(o){var a,r,c=t.create(e.getWidth(o),e.getHeight(o)),l=t.get2dContext(c);return l.drawImage(o,0,0),u(o),a=l.getImageData(0,0,c.width,c.height),r=l.getImageData(0,0,c.width,c.height),r=function(t,e,n){function o(t,e,n){return t>n?t=n:e>t&&(t=e),t}var i,a,r,c,l,u,s,d,g,f,m,h,p,y,v,b,w;for(r=Math.round(Math.sqrt(n.length)),c=Math.floor(r/2),i=t.data,a=e.data,b=t.width,w=t.height,u=0;w>u;u++)for(l=0;b>l;l++){for(s=d=g=0,m=0;r>m;m++)for(f=0;r>f;f++)h=o(l+f-c,0,b-1),p=o(u+m-c,0,w-1),y=4*(p*b+h),v=n[m*r+f],s+=i[y]*v,d+=i[y+1]*v,g+=i[y+2]*v;a[y=4*(u*b+l)]=o(s,0,255),a[y+1]=o(d,0,255),a[y+2]=o(g,0,255)}return e}(a,r,i),l.putImageData(r,0,0),n.canvasToBlob(c)})}function r(o){return function(i,a){return n.blobToImage(i).then(function(i){var r,c,l=t.create(e.getWidth(i),e.getHeight(i)),s=t.get2dContext(l),d=new Array(256);for(c=0;c<d.length;c++)d[c]=o(c,a);return s.drawImage(i,0,0),u(i),r=function(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}(s.getImageData(0,0,l.width,l.height),d),s.putImageData(r,0,0),n.canvasToBlob(l)})}}function c(t){return function(e,n){return i(e,t(o.identity(),n))}}function l(t){return function(e){return a(e,t)}}var u=n.revokeImageUrl;return{invert:function(t){return function(e){return i(e,t)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:c(o.adjustBrightness),hue:c(o.adjustHue),saturate:c(o.adjustSaturation),contrast:c(o.adjustContrast),grayscale:c(o.adjustGrayscale),sepia:c(o.adjustSepia),colorize:function(t,e,n,a){return i(t,o.adjustColors(o.identity(),e,n,a))},sharpen:l([0,-1,0,-1,5,-1,0,-1,0]),emboss:l([-2,-1,0,-1,1,1,0,1,2]),gamma:r(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:r(function(t,e){return 255*(1-Math.exp(-t/255*e))}),colorFilter:i,convoluteFilter:a}}),o("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function t(){return o>0}function e(){return-1!=o&&o<n.length-1}var n=[],o=-1;return{data:n,add:function(t){var e;return e=n.splice(++o),n.push(t),{state:t,removed:e}},undo:function(){return t()?n[--o]:void 0},redo:function(){return e()?n[++o]:void 0},canUndo:t,canRedo:e}}}),o("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(t,e,n,o,i,a,r,c,l,u,s){function d(t){return{blob:t,url:URL.createObjectURL(t)}}function g(t){t&&URL.revokeObjectURL(t.url)}function f(t){e.each(t,g)}function m(n,u,m){function h(t){var e,n,o,i;e=z.find("#w")[0],n=z.find("#h")[0],o=parseInt(e.value(),10),i=parseInt(n.value(),10),z.find("#constrain")[0].checked()&&J&&tt&&o&&i&&("w"==t.control.settings.name?(i=Math.round(o*et),n.value(i)):(o=Math.round(i*nt),e.value(o))),J=o,tt=i}function p(t){return Math.round(100*t)+"%"}function y(){z.find("#undo").disabled(!ot.canUndo()),z.find("#redo").disabled(!ot.canRedo()),z.statusbar.find("#save").disabled(!ot.canUndo())}function v(){z.find("#undo").disabled(!0),z.find("#redo").disabled(!0)}function b(t){t&&E.imageSrc(t.url)}function w(t){return function(){var n=e.grep(Q,function(e){return e.settings.name!=t});e.each(n,function(t){t.hide()}),t.show()}}function x(t){b(D=d(t))}function k(t){b(n=d(t)),f(ot.add(n).removed),y()}function I(t){var e=[].slice.call(arguments,1);return function(){var o=D||n;t.apply(this,[o.blob].concat(e)).then(x)}}function R(t){var e=[].slice.call(arguments,1);return function(){t.apply(this,[n.blob].concat(e)).then(k)}}function C(){b(n),g(D),w(H)(),y()}function M(){D&&(k(D.blob),C())}function T(t){return new i({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function B(t,e){return T([{text:"Back",onclick:C},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:M}]).hide().on("show",function(){v(),e(n.blob).then(function(t){var e=d(t);b(e),g(D),D=e})})}function U(t,e,o,i,a){function r(t){e(n.blob,t).then(function(t){var e=d(t);b(e),g(D),D=e})}return T([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){r(t.value)},minValue:i,maxValue:a,value:o,previewFilter:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:M}]).hide().on("show",function(){this.find("slider").value(o),v()})}var z,H,j,D,S,W,L,E,F,A,O,P,V,X,$,Y,_,G,q,K,Z,N,Q,J,tt,et,nt,ot=new s;S=T([{text:"Back",onclick:C},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:function(){var t=E.selection();c.crop(n.blob,t.x,t.y,t.w,t.h).then(function(t){k(t),C()})}}]).hide().on("show hide",function(t){E.toggleCropRect("show"==t.type)}).on("show",v),W=T([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:h},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:h},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(t){!0===t.control.value()&&(et=tt/J,nt=J/tt)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var e=parseInt(z.find("#w").value(),10),n=parseInt(z.find("#h").value(),10);t.preventDefault(),R(c.resize,e,n)(),C()}).on("show",v),L=T([{text:"Back",onclick:C},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:I(c.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:I(c.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:I(c.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:I(c.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:M}]).hide().on("show",v),O=B(0,l.invert),q=B(0,l.sharpen),K=B(0,l.emboss),P=U(0,l.brightness,0,-1,1),V=U(0,l.hue,180,0,360),X=U(0,l.saturate,0,-1,1),$=U(0,l.contrast,0,-1,1),Y=U(0,l.grayscale,0,0,1),_=U(0,l.sepia,0,0,1),G=function(t,e){function o(){var t,o,i;t=z.find("#r")[0].value(),o=z.find("#g")[0].value(),i=z.find("#b")[0].value(),e(n.blob,t,o,i).then(function(t){var e=d(t);b(e),g(D),D=e})}return T([{text:"Back",onclick:C},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:M}]).hide().on("show",function(){z.find("#r,#g,#b").value(1),v()})}(0,l.colorize),Z=U(0,l.gamma,0,-1,1),N=U(0,l.exposure,1,0,2),j=T([{text:"Back",onclick:C},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:w(V)},{text:"saturate",icon:"saturate",onclick:w(X)},{text:"sepia",icon:"sepia",onclick:w(_)},{text:"emboss",icon:"emboss",onclick:w(K)},{text:"exposure",icon:"exposure",onclick:w(N)},{type:"spacer",flex:1}]).hide(),H=T([{tooltip:"Crop",icon:"crop",onclick:w(S)},{tooltip:"Resize",icon:"resize2",onclick:w(W)},{tooltip:"Orientation",icon:"orientation",onclick:w(L)},{tooltip:"Brightness",icon:"sun",onclick:w(P)},{tooltip:"Sharpen",icon:"sharpen",onclick:w(q)},{tooltip:"Contrast",icon:"contrast",onclick:w($)},{tooltip:"Color levels",icon:"drop",onclick:w(G)},{tooltip:"Gamma",icon:"gamma",onclick:w(Z)},{tooltip:"Invert",icon:"invert",onclick:w(O)}]),E=new r({flex:1,imageSrc:n.url}),F=new a({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){b(n=ot.undo()),y()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){b(n=ot.redo()),y()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var t=E.zoom();2>t&&(t+=.1),E.zoom(t)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var t=E.zoom();t>.1&&(t-=.1),E.zoom(t)}}]}),A=new a({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[F,E]}),Q=[H,S,W,L,j,O,P,V,X,$,Y,_,G,q,K,Z,N],(z=o.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(t.DOM.getViewPort().w,800),minHeight:Math.min(t.DOM.getViewPort().h,650),title:"Edit image",items:Q.concat([A]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){u(n.blob),z.close()}},{text:"Cancel",onclick:"close"}]})).renderTo(document.body).reflow(),z.on("close",function(){m(),f(ot.data),ot=null,D=null}),ot.add(n),y(),E.on("load",function(){J=E.imageSize().w,tt=E.imageSize().h,et=tt/J,nt=J/tt,z.find("#w").value(J),z.find("#h").value(tt)})}return{edit:function(t){return new n(function(e,n){m(d(t),e,n)})}}}),o("tinymce/imagetoolsplugin/Plugin",["tinymce/PluginManager","tinymce/Env","tinymce/util/Promise","tinymce/util/URI","tinymce/util/Tools","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Dialog"],function(t,e,n,o,i,a,r,c){t.add("imagetools",function(t){function l(e){function n(t){return t.indexOf("px")==t.length-2}var o,i;return o=e.style.width,i=e.style.height,o||i?n(o)&&n(i)?{w:parseInt(o,10),h:parseInt(i,10)}:null:(o=t.$(e).attr("width"),i=t.$(e).attr("height"),o&&i?{w:parseInt(o,10),h:parseInt(i,10)}:null)}function u(e,n){var o,i;n&&(o=e.style.width,i=e.style.height,(o||i)&&t.$(e).css({width:n.w,height:n.h}).removeAttr("data-mce-style"),o=e.width,i=e.height,(o||i)&&t.$(e).attr({width:n.w,height:n.h}))}function s(t){return{w:t.naturalWidth,h:t.naturalHeight}}function d(){return t.selection.getNode()}function g(){return"imagetools"+R++}function f(e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new o(n).host===t.documentBaseURI.host}function m(e){return-1!==i.inArray(t.settings.imagetools_cors_hosts,new o(e.src).host)}function h(t){return new n(function(e){var n=new XMLHttpRequest;n.onload=function(){e(this.response)},n.open("GET",t,!0),n.responseType="blob",n.send()})}function p(e){var n=e.src;return m(e)?h(e.src):(f(e)||(e=new Image,n=t.settings.imagetools_proxy,e.src+=(-1===n.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src)),r.imageToBlob(e))}function y(){return t.editorUpload.blobCache.getByUri(d().src)||p(d()).then(function(e){return r.blobToBase64(e).then(function(n){var o=t.editorUpload.blobCache,i=o.create(g(),e,n);return o.add(i),i})})}function v(e){return r.blobToDataUri(e).then(function(n){var i,a,r,c,l;return l=d(),i=g(),r=t.editorUpload.blobCache,a=o.parseDataUri(n).data,c=r.create(i,e,a),r.add(c),t.undoManager.transact(function(){function e(){t.$(l).off("load",e),t.nodeChanged()}t.$(l).on("load",e),t.$(l).attr({src:c.blobUri()}).removeAttr("data-mce-src")}),c})}function b(e){return function(){return t._scanForImages().then(y).then(e).then(v)}}function w(t){return function(){return b(function(e){var n=l(d());return n&&u(d(),{w:n.h,h:n.w}),a.rotate(e.blob(),t)})()}}function x(t){return function(){return b(function(e){return a.flip(e.blob(),t)})()}}function k(){var t=d(),e=s(t);t&&p(t).then(c.edit).then(function(o){return new n(function(n){r.blobToImage(o).then(function(i){var a=s(i);(e.w!=a.w||e.h!=a.h)&&l(t)&&u(t,a),URL.revokeObjectURL(i.src),n(o)})})}).then(v,function(){})}function I(e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")&&(f(e)||m(e)||t.settings.imagetools_proxy)}var R=0;e.fileApi&&(t.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:w(-90)}),t.addButton("rotateright",{title:"Rotate clockwise",onclick:w(90)}),t.addButton("flipv",{title:"Flip vertically",onclick:x("v")}),t.addButton("fliph",{title:"Flip horizontally",onclick:x("h")}),t.addButton("editimage",{title:"Edit image",onclick:k}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),function(){var e=t.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),t.addContextToolbar(I,e)}())})}),function(n){var o,i,r,c,l;for(o=0;o<n.length;o++){i=t,c=(r=n[o]).split(/[.\/]/);for(var u=0;u<c.length-1;++u)i[c[u]]===e&&(i[c[u]]={}),i=i[c[u]];i[c[c.length-1]]=a[r]}if(t.AMDLC_TESTS){l=t.privateModules||{};for(r in a)l[r]=a[r];for(o=0;o<n.length;o++)delete l[n[o]];t.privateModules=l}}(["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/CropRect","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ColorMatrix","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/UndoStack","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/Plugin"])}(this);