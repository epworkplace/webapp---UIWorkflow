tinymce.PluginManager.add("textpattern",function(m){function c(){return a&&(n.sort(function(t,e){return t.start.length>e.start.length?-1:t.start.length<e.start.length?1:0}),a=!1),n}function h(t){for(var e=c(),n=0;n<e.length;n++)if(0===t.indexOf(e[n].start)&&(!e[n].end||t.lastIndexOf(e[n].end)==t.length-e[n].end.length))return e[n]}function d(t){var e,n,a,r,s,d,o,i,l,f,g;return e=m.selection,n=m.dom,e.isCollapsed()&&(a=e.getRng(!0),r=a.startContainer,s=a.startOffset,o=r.data,f=t?1:0,3==r.nodeType&&((l=function(t,e,n){var a,r,s;for(a=c(),s=0;s<a.length;s++)if((r=a[s]).end&&t.substr(e-r.end.length-n,r.end.length)==r.end)return r}(o,s,f))&&(d=Math.max(0,s-f),-1!==(d=o.lastIndexOf(l.start,d-l.end.length-1))&&((i=n.createRng()).setStart(r,d),i.setEnd(r,s-f),(l=h(i.toString()))&&l.end&&!(r.data.length<=l.start.length+l.end.length)))))?(g=m.formatter.get(l.format))&&g[0].inline?((r=r.splitText(d)).splitText(s-d-f),r.deleteData(0,l.start.length),r.deleteData(r.data.length-l.end.length,l.end.length),m.formatter.apply(l.format,{},r),r):void 0:void 0}function e(){var t,e;(e=d())&&((t=m.dom.createRng()).setStart(e,e.data.length),t.setEnd(e,e.data.length),m.selection.setRng(t)),function(){var t,e,n,a,r,s,d,o,i,l,f;if(t=m.selection,e=m.dom,t.isCollapsed()&&(d=e.getParent(t.getStart(),"p"))){for(i=new tinymce.dom.TreeWalker(d,d);r=i.next();)if(3==r.nodeType){a=r;break}if(a){if(!(o=h(a.data)))return;if(n=(l=t.getRng(!0)).startContainer,f=l.startOffset,a==n&&(f=Math.max(0,f-o.start.length)),tinymce.trim(a.data).length==o.start.length)return;o.format&&(s=m.formatter.get(o.format))&&s[0].block&&(a.deleteData(0,o.start.length),m.formatter.apply(o.format,{},a),l.setStart(n,f),l.collapse(!0),t.setRng(l)),o.cmd&&m.undoManager.transact(function(){a.deleteData(0,o.start.length),m.execCommand(o.cmd)})}}}()}var n,a=!0;n=m.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],m.on("keydown",function(t){13!=t.keyCode||tinymce.util.VK.modifierPressed(t)||e()},!0),m.on("keyup",function(t){var e,n,a,r,s;32!=t.keyCode||tinymce.util.VK.modifierPressed(t)||(e=d(!0))&&(s=m.dom,n=e.data.slice(-1),/[\u00a0 ]/.test(n)&&(e.deleteData(e.data.length-1,1),a=s.doc.createTextNode(n),e.nextSibling?s.insertAfter(a,e.nextSibling):e.parentNode.appendChild(a),(r=s.createRng()).setStart(a,1),r.setEnd(a,1),m.selection.setRng(r)))}),this.getPatterns=c,this.setPatterns=function(t){n=t,a=!0}});