tinymce.PluginManager.add("autolink",function(e){function t(e){o(e,-1,"(")}function n(e){o(e,0,"")}function i(e){o(e,-1,"")}function o(e,t,n){function i(e,t){if(0>t&&(t=0),3==e.nodeType){var n=e.data.length;t>n&&(t=n)}return t}function o(e,t){1!=e.nodeType||e.hasChildNodes()?d.setStart(e,i(e,t)):d.setStartBefore(e)}function r(e,t){1!=e.nodeType||e.hasChildNodes()?d.setEnd(e,i(e,t)):d.setEndAfter(e)}var d,f,a,s,l,c,u,h,g,C;if("A"!=e.selection.getNode().tagName){if((d=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(h=d.endContainer.previousSibling)){if(!d.endContainer.firstChild||!d.endContainer.firstChild.nextSibling)return;h=d.endContainer.firstChild.nextSibling}if(g=h.length,o(h,g),r(h,g),d.endOffset<5)return;f=d.endOffset,s=h}else{if(3!=(s=d.endContainer).nodeType&&s.firstChild){for(;3!=s.nodeType&&s.firstChild;)s=s.firstChild;3==s.nodeType&&(o(s,0),r(s,s.nodeValue.length))}f=1==d.endOffset?2:d.endOffset-1-t}a=f;do{o(s,f>=2?f-2:0),r(s,f>=1?f-1:0),f-=1,C=d.toString()}while(" "!=C&&""!==C&&160!=C.charCodeAt(0)&&f-2>=0&&C!=n);d.toString()==n||160==d.toString().charCodeAt(0)?(o(s,f),r(s,a),f+=1):0===d.startOffset?(o(s,0),r(s,a)):(o(s,f),r(s,a)),"."==(c=d.toString()).charAt(c.length-1)&&r(s,a-1),(u=(c=d.toString()).match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i))&&("www."==u[1]?u[1]="http://www.":/@$/.test(u[1])&&!/^mailto:/.test(u[1])&&(u[1]="mailto:"+u[1]),l=e.selection.getBookmark(),e.selection.setRng(d),e.execCommand("createlink",!1,u[1]+u[2]),e.selection.moveToBookmark(l),e.nodeChanged())}}var r;return e.on("keydown",function(t){return 13==t.keyCode?i(e):void 0}),tinymce.Env.ie?void e.on("focus",function(){if(!r){r=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}}):(e.on("keypress",function(n){return 41==n.keyCode?t(e):void 0}),void e.on("keyup",function(t){return 32==t.keyCode?n(e):void 0}))});