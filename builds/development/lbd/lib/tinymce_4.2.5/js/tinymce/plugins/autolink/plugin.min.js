tinymce.PluginManager.add("autolink",function(t){function n(e,t,n){function i(e,t){if(t<0&&(t=0),3==e.nodeType){var n=e.data.length;n<t&&(t=n)}return t}function o(e,t){1!=e.nodeType||e.hasChildNodes()?d.setStart(e,i(e,t)):d.setStartBefore(e)}function r(e,t){1!=e.nodeType||e.hasChildNodes()?d.setEnd(e,i(e,t)):d.setEndAfter(e)}var d,f,a,s,l,c,h,u,g,C;if("A"!=e.selection.getNode().tagName){if((d=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(u=d.endContainer.previousSibling)){if(!d.endContainer.firstChild||!d.endContainer.firstChild.nextSibling)return;u=d.endContainer.firstChild.nextSibling}if(o(u,g=u.length),r(u,g),d.endOffset<5)return;f=d.endOffset,s=u}else{if(3!=(s=d.endContainer).nodeType&&s.firstChild){for(;3!=s.nodeType&&s.firstChild;)s=s.firstChild;3==s.nodeType&&(o(s,0),r(s,s.nodeValue.length))}f=1==d.endOffset?2:d.endOffset-1-t}for(a=f;o(s,2<=f?f-2:0),r(s,1<=f?f-1:0),f-=1," "!=(C=d.toString())&&""!==C&&160!=C.charCodeAt(0)&&0<=f-2&&C!=n;);d.toString()==n||160==d.toString().charCodeAt(0)?(o(s,f),r(s,a),f+=1):(0===d.startOffset?o(s,0):o(s,f),r(s,a)),"."==(c=d.toString()).charAt(c.length-1)&&r(s,a-1),(h=(c=d.toString()).match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i))&&("www."==h[1]?h[1]="http://www.":/@$/.test(h[1])&&!/^mailto:/.test(h[1])&&(h[1]="mailto:"+h[1]),l=e.selection.getBookmark(),e.selection.setRng(d),e.execCommand("createlink",!1,h[1]+h[2]),e.selection.moveToBookmark(l),e.nodeChanged())}}var e;return t.on("keydown",function(e){return 13==e.keyCode?void n(t,-1,""):void 0}),tinymce.Env.ie?void t.on("focus",function(){if(!e){e=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}}):(t.on("keypress",function(e){return 41==e.keyCode?void n(t,-1,"("):void 0}),void t.on("keyup",function(e){return 32==e.keyCode?void n(t,0,""):void 0}))});