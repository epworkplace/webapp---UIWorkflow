tinymce.PluginManager.add("noneditable",function(e){function t(e){var t;if(1===e.nodeType){if((t=e.getAttribute(c))&&"inherit"!==t)return t;if("inherit"!==(t=e.contentEditable))return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(){function r(e){for(;e;){if(e.id===u)return e;e=e.parentNode}}function a(e){var t;if(e)for(t=new f(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function i(n,r){var a,i;return"false"===t(n)&&s.isBlock(n)?void c.select(n):(i=s.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode("Â ")),n=n.firstChild,r=!0),a=s.create("span",{id:u,"data-mce-bogus":!0},m),r?n.parentNode.insertBefore(a,n):s.insertAfter(a,n),i.setStart(a.firstChild,1),i.collapse(!0),c.setRng(i),a)}function o(e){var t,n,r;if(e)(t=c.getRng(!0)).setStartBefore(e),t.setEndBefore(e),(n=a(e))&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),s.remove(e,!0),c.setRng(t);else for(;(e=s.get(u))&&e!==r;)(n=a(e))&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),s.remove(e,!0),r=e}function l(){function e(e,n){var r,a,i,o,l;if(r=s.startContainer,a=s.startOffset,3==r.nodeType){if(l=r.nodeValue.length,a>0&&l>a||(n?a==l:0===a))return}else{if(!(a<r.childNodes.length))return n?null:e;var c=!n&&a>0?a-1:a;(r=r.childNodes[c]).hasChildNodes()&&(r=r.firstChild)}for(i=new f(r,e);o=i[n?"prev":"next"]();){if(3===o.nodeType&&o.nodeValue.length>0)return;if("true"===t(o))return o}return e}var r,a,l,s,d;o(),l=c.isCollapsed(),r=n(c.getStart()),a=n(c.getEnd()),(r||a)&&(s=c.getRng(!0),l?(r=r||a,(d=e(r,!0))?i(d,!0):(d=e(r,!1))?i(d,!1):c.select(r)):(s=c.getRng(!0),r&&s.setStartBefore(r),a&&s.setEndAfter(a),c.setRng(s)))}var s=e.dom,c=e.selection,u="mce_noneditablecaret",m="\ufeff";e.on("mousedown",function(n){var r=e.selection.getNode();r&&-1!==r.className.indexOf("mceTmpParagraph")&&r!==n.target&&("&nbsp;"===r.innerHTML||""===r.innerHTML||" "===r.innerHTML?s.remove(r):r.className=r.className.replace("mceTmpParagraph","")),"false"===t(r)&&r==n.target&&l()}),e.on("mouseup",l),e.on("keydown",function(a){function i(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function u(e,t){c.select(e),c.collapse(t)}var m,p,g,v,E=a.keyCode;l(),g=c.getStart(),v=c.getEnd(),m=n(g)||n(v);var T=e.selection.getNode(),h=E==d.LEFT||E==d.RIGHT||E==d.UP||E==d.DOWN,b=E==d.LEFT||E==d.UP;if(m&&(112>E||E>124)&&E!=d.DELETE&&E!=d.BACKSPACE){if((tinymce.isMac?a.metaKey:a.ctrlKey)&&(67==E||88==E||86==E))return;if(a.preventDefault(),h)if(e.dom.isBlock(m)){var C=b?m.previousSibling:m.nextSibling;if(!C||C&&"false"===t(C)){var y=s.create("p",null,"&nbsp;");y.className="mceTmpParagraph";var N=b?m:C;N&&N.parentNode?N.parentNode.insertBefore(y,N):C||b||m.parentNode.appendChild(y),C=y}var S=new f(C,C);u(b?S.prev():S.next(),!b)}else u(m,b)}else if(h||E==d.BACKSPACE||E==d.DELETE){if(p=r(g)){if(E==d.LEFT||E==d.BACKSPACE)if((m=i(p,!0))&&"false"===t(m)){if(a.preventDefault(),E!=d.LEFT)return void s.remove(m);u(m,!0)}else o(p);if(E==d.RIGHT||E==d.DELETE)if((m=i(p,!0))&&"false"===t(m)){if(a.preventDefault(),E!=d.RIGHT)return void s.remove(m);u(m,!1)}else o(p)}else{if(h&&T&&-1!==T.className.indexOf("mceTmpParagraph")&&T[b?"previousSibling":"nextSibling"]){var A=T[b?"previousSibling":"nextSibling"];"&nbsp;"===T.innerHTML||""===T.innerHTML||" "===T.innerHTML?s.remove(T):T.className=T.className.replace("mceTmpParagraph",""),u(A,!b)}var B=c.getRng(!0),P=B.endContainer;if(s.isBlock(P)&&s.isBlock(P.nextSibling)&&1==B.endOffset&&E==d.DELETE&&(m=n(P.nextSibling)),m&&(E==d.DELETE||E==d.BACKSPACE)&&s.isBlock(m))return a.preventDefault(),void s.remove(m)}if((E==d.BACKSPACE||E==d.DELETE)&&!function(a){function i(e){for(var t=f;t;){if(t===e)return;t=t.parentNode}s.remove(e),l()}var o,f,d,u;if(c.isCollapsed()){if(o=c.getRng(!0),f=o.startContainer,d=o.startOffset,f=r(f)||f,u=n(f))return i(u),!1;if(3==f.nodeType&&(a?d>0:d<f.nodeValue.length))return!0;if(1==f.nodeType&&(f=f.childNodes[d]||f),function(){var r,o,l=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(f,e.getBody());(r=a?o.prev():o.next())&&!l[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return i(r),!0;return!!n(r)}())return!1}return!0}(E==d.BACKSPACE))return a.preventDefault(),!1}})}function a(t){var n=l.length,r=t.content,a=tinymce.trim(o);if("raw"!=t.format){for(;n--;)r=r.replace(l[n],function(t){var n=arguments,i=n[n.length-2];return i>0&&'"'==r.charAt(i-1)?t:'<span class="'+a+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var i,o,l,f=tinymce.dom.TreeWalker,s="contenteditable",c="data-mce-"+s,d=tinymce.util.VK;i=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",o=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",(l=e.getParam("noneditable_regexp"))&&!l.length&&(l=[l]),e.on("PreInit",function(){r(),l&&e.on("BeforeSetContent",a),e.parser.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)n=e[r],-1!==(t=" "+n.attr("class")+" ").indexOf(i)?n.attr(c,"true"):-1!==t.indexOf(o)&&n.attr(c,"false")}),e.serializer.addAttributeFilter(c,function(e){for(var t,n=e.length;n--;)t=e[n],l&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(s,null),t.attr(c,null))}),e.parser.addAttributeFilter(s,function(e){for(var t,n=e.length;n--;)(t=e[n]).attr(c,t.attr(s)),t.attr(s,null)})}),e.on("drop",function(e){n(e.target)&&e.preventDefault()})});