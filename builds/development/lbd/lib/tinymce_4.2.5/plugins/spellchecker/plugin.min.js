!function(e,t){"use strict";function n(e,t){for(var n,r=[],c=0;c<e.length;++c){if(!(n=i[e[c]]||o(e[c])))throw"module definition dependecy not found: "+e[c];r.push(n)}t.apply(null,r)}function r(e,r,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(r,function(){i[e]=o.apply(null,arguments)})}function o(t){for(var n=e,r=t.split(/[.\/]/),o=0;o<r.length;++o){if(!n[r[o]])return;n=n[r[o]]}return n}var i={};r("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(e,t){function n(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}}function r(e){var t;if(3===e.nodeType)return e.data;if(g[e.nodeName]&&!p[e.nodeName])return"";if(t="",(p[e.nodeName]||m[e.nodeName])&&(t+="\n"),e=e.firstChild)do{t+=r(e)}while(e=e.nextSibling);return t}function o(e,t,n){var r,o,i,c,a,l=[],s=0,d=e,u=0;(t=t.slice(0)).sort(function(e,t){return e.start-t.start}),a=t.shift();e:for(;;){if((p[d.nodeName]||m[d.nodeName])&&s++,3===d.nodeType&&(!o&&d.length+s>=a.end?(o=d,c=a.end-s):r&&l.push(d),!r&&d.length+s>a.start&&(r=d,i=a.start-s),s+=d.length),r&&o){if(d=n({startNode:r,startNodeIndex:i,endNode:o,endNodeIndex:c,innerNodes:l,match:a.text,matchIndex:u}),s-=o.length-c,r=null,o=null,l=[],a=t.shift(),u++,!a)break}else{if((!g[d.nodeName]||p[d.nodeName])&&d.firstChild){d=d.firstChild;continue}if(d.nextSibling){d=d.nextSibling;continue}}for(;;){if(d.nextSibling){d=d.nextSibling;break}if(d.parentNode===e)break e;d=d.parentNode}}}function i(e){function t(t,n){var r=v[n];r.stencil||(r.stencil=e(r));var o=r.stencil.cloneNode(!1);return o.setAttribute("data-mce-index",n),t&&o.appendChild(x.doc.createTextNode(t)),o}return function(e){var n,r,o,i=e.startNode,c=e.endNode,a=e.matchIndex,l=x.doc;if(i===c){var s=i;o=s.parentNode,e.startNodeIndex>0&&(n=l.createTextNode(s.data.substring(0,e.startNodeIndex)),o.insertBefore(n,s));var d=t(e.match,a);return o.insertBefore(d,s),e.endNodeIndex<s.length&&(r=l.createTextNode(s.data.substring(e.endNodeIndex)),o.insertBefore(r,s)),s.parentNode.removeChild(s),d}n=l.createTextNode(i.data.substring(0,e.startNodeIndex)),r=l.createTextNode(c.data.substring(e.endNodeIndex));for(var u=t(i.data.substring(e.startNodeIndex),a),f=[],h=0,p=e.innerNodes.length;p>h;++h){var g=e.innerNodes[h],m=t(g.data,a);g.parentNode.replaceChild(m,g),f.push(m)}var v=t(c.data.substring(0,e.endNodeIndex),a);return(o=i.parentNode).insertBefore(n,i),o.insertBefore(u,i),o.removeChild(i),(o=c.parentNode).insertBefore(v,c),o.insertBefore(r,c),o.removeChild(c),v}}function c(e){e.parentNode.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function a(t){var n=e.getElementsByTagName("*"),r=[];t="number"==typeof t?""+t:null;for(var o=0;o<n.length;o++){var i=n[o],c=i.getAttribute("data-mce-index");null!==c&&c.length&&(c===t||null===t)&&r.push(i)}return r}function l(e){for(var t=v.length;t--;)if(v[t]===e)return t;return-1}function s(e){for(var t=0,n=v.length;n>t&&!1!==e(v[t],t);t++);return this}function d(e){var t,n=a(e?l(e):null);for(t=n.length;t--;)c(n[t]);return this}function u(e){var n=a(l(e)),r=t.dom.createRng();return r.setStartBefore(n[0]),r.setEndAfter(n[n.length-1]),r}var f,h,p,g,m,v=[],x=t.dom;return p=t.schema.getBlockElements(),g=t.schema.getWhiteSpaceElements(),m=t.schema.getShortEndedElements(),h=r(e),{text:h,matches:v,each:s,filter:function(e){var t=[];return s(function(n,r){e(n,r)&&t.push(n)}),v=t,this},reset:function(){return v.splice(0,v.length),d(),this},matchFromElement:function(e){return v[e.getAttribute("data-mce-index")]},elementFromMatch:function(e){return a(l(e))[0]},find:function(e,t){if(h&&e.global)for(;f=e.exec(h);)v.push(n(f,t));return this},add:function(e,t,n){return v.push({start:e,end:e+t,text:h.substr(e,t),data:n}),this},wrap:function(t){return v.length&&o(e,v,i(t)),this},unwrap:d,replace:function(e,n){var r=u(e);return r.deleteContents(),n.length>0&&r.insertNode(t.dom.doc.createTextNode(n)),r},rangeFromMatch:u,indexOf:l}}}),r("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(e,t,n,r,o,i,c,a){t.add("spellchecker",function(t,l){function s(){return B.textMatcher||(B.textMatcher=new e(t.getBody(),t)),B.textMatcher}function d(e){for(var t in e)return!1;return!0}function u(e,i){var c=[],a=b[e];n.each(a,function(e){c.push({text:e,onclick:function(){t.insertContent(t.dom.encode(e)),t.dom.remove(i),m()}})}),c.push({text:"-"}),C&&c.push({text:"Add to Dictionary",onclick:function(){v(e,i)}}),c.push.apply(c,[{text:"Ignore",onclick:function(){x(e,i)}},{text:"Ignore all",onclick:function(){x(e,i,!0)}}]),(M=new r({items:c,context:"contextmenu",onautohide:function(e){-1!=e.target.className.indexOf("spellchecker")&&e.preventDefault()},onhide:function(){M.remove(),M=null}})).renderTo(document.body);var l=o.DOM.getPos(t.getContentAreaContainer()),s=t.dom.getPos(i[0]),d=t.dom.getRoot();"BODY"==d.nodeName?(s.x-=d.ownerDocument.documentElement.scrollLeft||d.scrollLeft,s.y-=d.ownerDocument.documentElement.scrollTop||d.scrollTop):(s.x-=d.scrollLeft,s.y-=d.scrollTop),l.x+=s.x,l.y+=s.y,M.moveTo(l.x,l.y+i[0].offsetHeight)}function f(){return t.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„    ]+',"g")}function h(e,t,r,o){var s={method:e},d="";"spellcheck"==e&&(s.text=t,s.lang=E.spellchecker_language),"addToDictionary"==e&&(s.word=t),n.each(s,function(e,t){d&&(d+="&"),d+=t+"="+encodeURIComponent(e)}),i.send({url:new c(l).toAbsolute(E.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:d,success:function(e){(e=a.parse(e))?e.error?o(e.error):r(e):o("Sever response wasn't proper JSON.")},error:function(e,t){o("Spellchecker request error: "+t.status)}})}function p(e,t,n,r){(E.spellchecker_callback||h).call(B,e,t,n,r)}function g(){N(),T||(t.setProgressState(!0),p("spellcheck",s().text,y,function(e){t.windowManager.alert(e),t.setProgressState(!1),N()}),t.focus())}function m(){t.dom.select("span.mce-spellchecker-word").length||N()}function v(e,n){t.setProgressState(!0),p("addToDictionary",e,function(){t.setProgressState(!1),t.dom.remove(n,!0),m()},function(e){t.windowManager.alert(e),t.setProgressState(!1)})}function x(e,r,o){t.selection.collapse(),o?n.each(t.dom.select("span.mce-spellchecker-word"),function(n){n.getAttribute("data-mce-word")==e&&t.dom.remove(n,!0)}):t.dom.remove(r,!0),m()}function N(){s().reset(),B.textMatcher=null,T&&(T=!1,t.fire("SpellcheckEnd"))}function k(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function w(e){var r,o=[];if((r=n.toArray(t.getBody().getElementsByTagName("span"))).length)for(var i=0;i<r.length;i++){var c=k(r[i]);null!==c&&c.length&&c===e.toString()&&o.push(r[i])}return o}function y(e){var n;return e.words?(C=!!e.dictionary,n=e.words):n=e,t.setProgressState(!1),d(n)?(t.windowManager.alert("No misspellings found"),void(T=!1)):(b=n,s().find(f()).filter(function(e){return!!n[e.text]}).wrap(function(e){return t.dom.create("span",{class:"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":e.text})}),T=!0,void t.fire("SpellcheckStart"))}var S,b,T,M,C,B=this,E=t.settings,I=E.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";S=function(e,t){var r=[];return n.each(t,function(e){r.push({selectable:!0,text:e.name,data:e.value})}),r}(0,n.map(I.split(","),function(e){return e=e.split("="),{name:e[0],value:e[1]}})),t.on("click",function(e){var n=e.target;if("mce-spellchecker-word"==n.className){e.preventDefault();var r=w(k(n));if(r.length>0){var o=t.dom.createRng();o.setStartBefore(r[0]),o.setEndAfter(r[r.length-1]),t.selection.setRng(o),u(n.getAttribute("data-mce-word"),r)}}}),t.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:g,selectable:!0,onPostRender:function(){var e=this;e.active(T),t.on("SpellcheckStart SpellcheckEnd",function(){e.active(T)})}});var D={tooltip:"Spellcheck",onclick:g,onPostRender:function(){var e=this;t.on("SpellcheckStart SpellcheckEnd",function(){e.active(T)})}};S.length>1&&(D.type="splitbutton",D.menu=S,D.onshow=function(e){var t=E.spellchecker_language;e.control.items().each(function(e){e.active(e.settings.data===t)})},D.onselect=function(e){E.spellchecker_language=e.control.settings.data}),t.addButton("spellchecker",D),t.addCommand("mceSpellCheck",g),t.on("remove",function(){M&&(M.remove(),M=null)}),t.on("change",m),this.getTextMatcher=s,this.getWordCharPattern=f,this.markErrors=y,this.getLanguage=function(){return E.spellchecker_language},E.spellchecker_language=E.spellchecker_language||E.language||"en"})}),function(n){var r,o,c,a,l;for(r=0;r<n.length;r++){o=e,a=(c=n[r]).split(/[.\/]/);for(var s=0;s<a.length-1;++s)o[a[s]]===t&&(o[a[s]]={}),o=o[a[s]];o[a[a.length-1]]=i[c]}if(e.AMDLC_TESTS){l=e.privateModules||{};for(c in i)l[c]=i[c];for(r=0;r<n.length;r++)delete l[n[r]];e.privateModules=l}}(["tinymce/spellcheckerplugin/DomTextMatcher"])}(this);