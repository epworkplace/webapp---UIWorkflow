!function(e,t){var n={smoketimeout:[],init:!1,zindex:1e3,i:0,bodyload:function(e){var i=t.createElement("div");i.setAttribute("id","smoke-out-"+e),i.className="smoke-base",i.style.zIndex=n.zindex,n.zindex++,t.body.appendChild(i)},newdialog:function(){var t=(new Date).getTime();return t=Math.random(1,99)+t,n.init?n.bodyload(t):n.listen(e,"load",function(){n.bodyload(t)}),t},forceload:function(){},build:function(t,i){n.i++,i.stack=n.i,t=t.replace(/\n/g,"<br />"),t=t.replace(/\r/g,"<br />");var o,a="",l="OK",c="Cancel",d="",s="";"prompt"===i.type&&(a='<div class="dialog-prompt"><input id="dialog-input-'+i.newid+'" type="text" '+(i.params.value?'value="'+i.params.value+'"':"")+" /></div>"),i.params.ok&&(l=i.params.ok),i.params.cancel&&(c=i.params.cancel),i.params.classname&&(d=i.params.classname),"signal"!==i.type&&(s='<div class="dialog-buttons">',"alert"===i.type?s+='<button id="alert-ok-'+i.newid+'">'+l+"</button>":"quiz"===i.type?(i.params.button_1&&(s+='<button class="quiz-button" id="'+i.type+"-ok1-"+i.newid+'">'+i.params.button_1+"</button>"),i.params.button_2&&(s+='<button class="quiz-button" id="'+i.type+"-ok2-"+i.newid+'">'+i.params.button_2+"</button>"),i.params.button_3&&(s+='<button class="quiz-button" id="'+i.type+"-ok3-"+i.newid+'">'+i.params.button_3+"</button>"),i.params.button_cancel&&(s+='<button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+i.params.button_cancel+"</button>")):"prompt"!==i.type&&"confirm"!==i.type||(i.params.reverseButtons?s+='<button id="'+i.type+"-ok-"+i.newid+'">'+l+'</button><button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+c+"</button>":s+='<button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+c+'</button><button id="'+i.type+"-ok-"+i.newid+'">'+l+"</button>"),s+="</div>"),o='<div id="smoke-bg-'+i.newid+'" class="smokebg"></div><div class="dialog smoke '+d+'"><div class="dialog-inner">'+t+a+s+"</div></div>",n.init?n.finishbuild(t,i,o):n.listen(e,"load",function(){n.finishbuild(t,i,o)})},finishbuild:function(e,i,o){var a=t.getElementById("smoke-out-"+i.newid);for(a.className="smoke-base smoke-visible  smoke-"+i.type,a.innerHTML=o;""===a.innerHTML;)a.innerHTML=o;switch(n.smoketimeout[i.newid]&&clearTimeout(n.smoketimeout[i.newid]),n.listen(t.getElementById("smoke-bg-"+i.newid),"click",function(){n.destroy(i.type,i.newid),"prompt"===i.type||"confirm"===i.type||"quiz"===i.type?i.callback(!1):"alert"===i.type&&void 0!==i.callback&&i.callback()}),i.type){case"alert":n.finishbuildAlert(e,i,o);break;case"confirm":n.finishbuildConfirm(e,i,o);break;case"quiz":n.finishbuildQuiz(e,i,o);break;case"prompt":n.finishbuildPrompt(e,i,o);break;case"signal":n.finishbuildSignal(e,i,o);break;default:throw"Unknown type: "+i.type}},finishbuildAlert:function(i,o,a){n.listen(t.getElementById("alert-ok-"+o.newid),"click",function(){n.destroy(o.type,o.newid),void 0!==o.callback&&o.callback()}),t.onkeyup=function(t){t||(t=e.event),13!==t.keyCode&&32!==t.keyCode&&27!==t.keyCode||(n.destroy(o.type,o.newid),void 0!==o.callback&&o.callback())}},finishbuildConfirm:function(i,o,a){n.listen(t.getElementById("confirm-cancel-"+o.newid),"click",function(){n.destroy(o.type,o.newid),o.callback(!1)}),n.listen(t.getElementById("confirm-ok-"+o.newid),"click",function(){n.destroy(o.type,o.newid),o.callback(!0)}),t.onkeyup=function(t){t||(t=e.event),13===t.keyCode||32===t.keyCode?(n.destroy(o.type,o.newid),o.callback(!0)):27===t.keyCode&&(n.destroy(o.type,o.newid),o.callback(!1))}},finishbuildQuiz:function(i,o,a){var l,c,d;n.listen(t.getElementById("quiz-cancel-"+o.newid),"click",function(){n.destroy(o.type,o.newid),o.callback(!1)}),(l=t.getElementById("quiz-ok1-"+o.newid))&&n.listen(l,"click",function(){n.destroy(o.type,o.newid),o.callback(l.innerHTML)}),(c=t.getElementById("quiz-ok2-"+o.newid))&&n.listen(c,"click",function(){n.destroy(o.type,o.newid),o.callback(c.innerHTML)}),(d=t.getElementById("quiz-ok3-"+o.newid))&&n.listen(d,"click",function(){n.destroy(o.type,o.newid),o.callback(d.innerHTML)}),t.onkeyup=function(t){t||(t=e.event),27===t.keyCode&&(n.destroy(o.type,o.newid),o.callback(!1))}},finishbuildPrompt:function(i,o,a){var l=t.getElementById("dialog-input-"+o.newid);setTimeout(function(){l.focus(),l.select()},100),n.listen(t.getElementById("prompt-cancel-"+o.newid),"click",function(){n.destroy(o.type,o.newid),o.callback(!1)}),n.listen(t.getElementById("prompt-ok-"+o.newid),"click",function(){n.destroy(o.type,o.newid),o.callback(l.value)}),t.onkeyup=function(t){t||(t=e.event),13===t.keyCode?(n.destroy(o.type,o.newid),o.callback(l.value)):27===t.keyCode&&(n.destroy(o.type,o.newid),o.callback(!1))}},finishbuildSignal:function(i,o,a){t.onkeyup=function(t){t||(t=e.event),27===t.keyCode&&(n.destroy(o.type,o.newid),void 0!==o.callback&&o.callback())},n.smoketimeout[o.newid]=setTimeout(function(){n.destroy(o.type,o.newid),void 0!==o.callback&&o.callback()},o.timeout)},destroy:function(e,i){var o=t.getElementById("smoke-out-"+i);if("quiz"!==e)var a=t.getElementById(e+"-ok-"+i);var l=t.getElementById(e+"-cancel-"+i);if(o.className="smoke-base",a&&(n.stoplistening(a,"click",function(){}),t.onkeyup=null),"quiz"===e)for(var c=t.getElementsByClassName("quiz-button"),d=0;d<c.length;d++)n.stoplistening(c[d],"click",function(){}),t.onkeyup=null;l&&n.stoplistening(l,"click",function(){}),n.i=0,o.innerHTML=""},alert:function(e,t,i){"object"!=typeof i&&(i=!1);var o=n.newdialog();n.build(e,{type:"alert",callback:t,params:i,newid:o})},signal:function(e,t,i){"object"!=typeof i&&(i=!1);var o=5e3;"undefined"!==i.duration&&(o=i.duration);var a=n.newdialog();n.build(e,{type:"signal",callback:t,timeout:o,params:i,newid:a})},confirm:function(e,t,i){"object"!=typeof i&&(i=!1);var o=n.newdialog();n.build(e,{type:"confirm",callback:t,params:i,newid:o})},quiz:function(e,t,i){"object"!=typeof i&&(i=!1);var o=n.newdialog();n.build(e,{type:"quiz",callback:t,params:i,newid:o})},prompt:function(e,t,i){"object"!=typeof i&&(i=!1);var o=n.newdialog();return n.build(e,{type:"prompt",callback:t,params:i,newid:o})},listen:function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):!!e.attachEvent&&e.attachEvent("on"+t,n)},stoplistening:function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):!!e.detachEvent&&e.detachEvent("on"+t,n)}};n.init=!0,"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd?define("smoke",[],function(){return n}):this.smoke=n}(window,document);