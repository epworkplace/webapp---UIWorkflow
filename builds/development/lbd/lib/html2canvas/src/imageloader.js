function ImageLoader(e,t){this.link=null,this.options=e,this.support=t,this.origin=this.getOrigin(window.location.href)}ImageLoader.prototype.findImages=function(e){var t=[];return e.reduce(function(e,t){switch(t.node.nodeName){case"IMG":return e.concat([{args:[t.node.src],method:"url"}]);case"svg":case"IFRAME":return e.concat([{args:[t.node],method:t.node.nodeName}])}return e},[]).forEach(this.addImage(t,this.loadImage),this),t},ImageLoader.prototype.findBackgroundImage=function(e,t){return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e,this.loadImage),this),e},ImageLoader.prototype.addImage=function(e,t){return function(n){n.args.forEach(function(i){this.imageExists(e,i)||(e.splice(0,0,t.call(this,n)),log("Added image #"+e.length,"string"==typeof i?i.substring(0,100):i))},this)}},ImageLoader.prototype.hasImageBackground=function(e){return"none"!==e.method},ImageLoader.prototype.loadImage=function(e){if("url"===e.method){var t=e.args[0];return!this.isSVG(t)||this.support.svg||this.options.allowTaint?t.match(/data:image\/.*;base64,/i)?new ImageContainer(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(t)||!0===this.options.allowTaint||this.isSVG(t)?new ImageContainer(t,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ImageContainer(t,!0):this.options.proxy?new ProxyImageContainer(t,this.options.proxy):new DummyImageContainer(t):new SVGContainer(t)}return"linear-gradient"===e.method?new LinearGradientContainer(e):"gradient"===e.method?new WebkitGradientContainer(e):"svg"===e.method?new SVGNodeContainer(e.args[0],this.support.svg):"IFRAME"===e.method?new FrameContainer(e.args[0],this.isSameOrigin(e.args[0].src),this.options):new DummyImageContainer(e)},ImageLoader.prototype.isSVG=function(e){return"svg"===e.substring(e.length-3).toLowerCase()||SVGContainer.prototype.isInline(e)},ImageLoader.prototype.imageExists=function(e,t){return e.some(function(e){return e.src===t})},ImageLoader.prototype.isSameOrigin=function(e){return this.getOrigin(e)===this.origin},ImageLoader.prototype.getOrigin=function(e){var t=this.link||(this.link=document.createElement("a"));return t.href=e,t.href=t.href,t.protocol+t.hostname+t.port},ImageLoader.prototype.getPromise=function(e){return this.timeout(e,this.options.imageTimeout).catch(function(){return new DummyImageContainer(e.src).promise.then(function(t){e.image=t})})},ImageLoader.prototype.get=function(e){var t=null;return this.images.some(function(n){return(t=n).src===e})?t:null},ImageLoader.prototype.fetch=function(e){return this.images=e.reduce(bind(this.findBackgroundImage,this),this.findImages(e)),this.images.forEach(function(e,t){e.promise.then(function(){log("Succesfully loaded image #"+(t+1),e)},function(n){log("Failed loading image #"+(t+1),e,n)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),log("Finished searching images"),this},ImageLoader.prototype.timeout=function(e,t){var n,i=Promise.race([e.promise,new Promise(function(i,o){n=setTimeout(function(){log("Timed out loading image",e),o(e)},t)})]).then(function(e){return clearTimeout(n),e});return i.catch(function(){clearTimeout(n)}),i};