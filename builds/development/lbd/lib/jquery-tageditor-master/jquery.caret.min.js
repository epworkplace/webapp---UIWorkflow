jQuery.fn.caret=function(e){var t=this[0],n="true"===t.contentEditable;if(0==arguments.length){if(window.getSelection)return n?(t.focus(),(a=(o=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(t),a.setEnd(o.endContainer,o.endOffset),a.toString().length):t.selectionStart;if(document.selection){if(t.focus(),n){var o=document.selection.createRange();return(a=document.body.createTextRange()).moveToElementText(t),a.setEndPoint("EndToEnd",o),a.text.length}var e=0,c=t.createTextRange(),a=document.selection.createRange().duplicate(),r=a.getBookmark();for(c.moveToBookmark(r);0!==c.moveStart("character",-1);)e++;return e}return t.selectionStart?t.selectionStart:0}return-1==e&&(e=this[n?"text":"val"]().length),window.getSelection?n?(t.focus(),window.getSelection().collapse(t.firstChild,e)):t.setSelectionRange(e,e):document.body.createTextRange&&(n?((c=document.body.createTextRange()).moveToElementText(t),c.moveStart("character",e),c.collapse(!0),c.select()):((c=t.createTextRange()).move("character",e),c.select())),n||t.focus(),e};